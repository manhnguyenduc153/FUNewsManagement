@using Frontend.Services
@inject IJwtHelperService JwtHelper

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - FUNews</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">


    <link rel="stylesheet" href="~/css/site.css" />
</head>
<body>

    <div class="layout">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-title">FUNews</div>

            <nav class="sidebar-nav">
                <a href="/PublicNews" class="nav-link">
                    Public News
                </a>
                <hr class="sidebar-divider my-2">
                
                @{
                    var userInfo = JwtHelper.GetUserInfo();
                    var isLoggedIn = userInfo.IsAuthenticated;
                    var userName = userInfo.UserName;
                    var userEmail = userInfo.Email;
                    var userRole = userInfo.Role;
                }

                @if (isLoggedIn)
                {
                    <div class="sidebar-subtitle">Management</div>
                    
                    @if (userRole == "Admin")
                    {
                        <a href="/Dashboard" class="nav-link">
                            Dashboard
                        </a>
                        <a href="/SystemAccount" class="nav-link">
                            System Accounts
                        </a>
                        <a href="/NewsArticle" class="nav-link">
                            News Articles
                        </a>
                        <a href="/Category" class="nav-link">
                            Categories
                        </a>
                        <a href="/Tag" class="nav-link">
                            Tags
                        </a>
                        <a href="/Report" class="nav-link">
                            Reports
                        </a>
                        <a href="/AuditLog" class="nav-link">
                            Audit Log
                        </a>
                    }
                    
                    @if (userRole == "Staff")
                    {
                        <a href="/NewsArticle/MyArticles" class="nav-link">
                            My Articles
                        </a>
                        <a href="/Category" class="nav-link">
                            Categories
                        </a>
                        <a href="/Tag" class="nav-link">
                            Tags
                        </a>
                    }
                    
                    <hr class="sidebar-divider my-2">
                    <div class="sidebar-user-info">
                        <div class="user-name">
                            @userName
                        </div>
                        <div class="user-email">
                            @userEmail
                        </div>
                    </div>
                    <a href="/Login/Logout" class="nav-link text-danger">
                        Logout
                    </a>
                }
                else
                {
                    <a href="/Login" class="nav-link btn btn-primary w-100">
                        Login
                    </a>
                }
            </nav>
        </aside>

        <!-- CONTENT -->
        <main class="content">
            @RenderBody()
        </main>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function() {
            @if (TempData["SuccessMessage"] != null)
            {
                <text>
                var toast = `<div class="toast-container position-fixed bottom-0 end-0 p-3">
                    <div class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="d-flex">
                            <div class="toast-body">@TempData["SuccessMessage"]</div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                </div>`;
                $('body').append(toast);
                var toastEl = $('.toast').last()[0];
                new bootstrap.Toast(toastEl, {delay: 3000}).show();
                </text>
            }
            @if (TempData["ErrorMessage"] != null)
            {
                <text>
                var toast = `<div class="toast-container position-fixed bottom-0 end-0 p-3">
                    <div class="toast align-items-center text-bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="d-flex">
                            <div class="toast-body">@TempData["ErrorMessage"]</div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                </div>`;
                $('body').append(toast);
                var toastEl = $('.toast').last()[0];
                new bootstrap.Toast(toastEl, {delay: 3000}).show();
                </text>
            }
        });
    </script>

    @RenderSection("Scripts", required: false)

</body>
</html>
